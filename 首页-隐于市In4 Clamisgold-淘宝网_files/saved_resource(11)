KISSY.add("modules/shop/coupon-mod/coupon/index",function(a,b){function c(a){var b=this;b.config=a,b.safeCode=a.safeCode,b.applyUrl=a.url,b.init()}var a=KISSY,d=a.DOM,e=a.Event;return window.location.href.indexOf("jiyoujia.com")>-1?loHref="//shop"+shop_config.shopId+".taobao.com/dc-3773.htm":loHref=location.href,a.augment(c,e.Target,{init:function(){var a=this,b=!1;if(-1==loHref.indexOf("taobao"))b=!0;else{var c=function(a){var b,c;return(c=String(document.cookie).match(new RegExp("(?:^| )"+a+"(?:(?:=([^;]*))|;|$)")))&&(b=c[1]?decodeURIComponent(c[1]):""),b};b=!!(c("_l_g_")&&c("_nk_")||c("ck1")&&c("tracknick")||c("lgc"))}a.initLogin(b)},normalize:function(a){return a=this.daily?a.replace("a.tbcdn.cn","assets.daily.taobao.net").replace("taobao.com","daily.taobao.net"):a.replace("assets.daily.taobao.net","a.tbcdn.cn").replace("daily.taobao.net","taobao.com")},initLogin:function(b){var c=this;if(0==b){goldlog&&goldlog.send("//ga.mmstat.com/tbtwlact.2.2",{});var f=c.normalize("//login.taobao.com/member/login.jhtml?style=mini&is_ignore=false&full_redirect=true"),g='<div class="sns-login-content"><div class="sns-login-wrap"><div class="sns-login-title">\u6dd8\u5b9d\u4f1a\u5458</div><iframe width="330" height="285" frameborder="0"scrolling="no" src="'+f+'&redirect_url={redirectUrl}"></iframe></div><s style="display:{closeBtn}" class="sns-close-btn">&times;</s></div>';d.addStyleSheet(".sns-close-btn {    color:#9c9c97;    text-decoration:none;    font-size:22px;    position:absolute;    right:12px;    top:5px;    cursor:pointer;}.sns-popup-login { position:absolute;}.sns-login-content {   border-radius: 3px; border:3px solid #d5d5d5; background-color:#FAFAFA;}.sns-login-wrap {   width: 330px;    border: 1px solid #aaa;   overflow: hidden; }.sns-login-title {   background: #f2f2f2;   height: 35px;   line-height: 35px;   font-size: 14px;   font-weight: 700;   color: #000;   padding-left: 15px;   margin-bottom: 25px;}");var h=new a.Overlay({elCls:"sns-popup-login",content:a.substitute(g,{closeBtn:"block",redirectUrl:encodeURIComponent(loHref)}),zIndex:1e9,mask:!1,align:{node:null,points:["cc","cc"],offset:[0,0]}});h.render(),h.show();var i;i=a.isFunction(h.get)?h.get("el").getDOMNode():h.container,e.on(d.get(".sns-close-btn",i),"click",function(){h.destroy()})}else a.io({url:c.applyUrl,data:{safeCode:c.safeCode},cache:!1,dataType:"jsonp",success:function(a){if(a.success)if(a.data&&a.data.success)c.renderPop(a.data);else{if(a.data&&"NEED_LOGIN"==a.data.errCode)return void c.initLogin(!1);c.renderPop(a.data)}else{if(a.code&&"NEED_LOGIN"==a.code)return void c.initLogin(!1);a.msg?c.renderPop({success:!1,title:a.msg}):alert("\u7cfb\u7edf\u9519\u8bef")}}})},hasParam:function(a){return a.indexOf("?")>-1?a+"&":a+"?"},renderPop:function(a){var c=this,f="",g='<div style="margin-top: 20px;color: #666;"><a class="J_close">\u786e \u5b9a</a>',h='<div class="applyCouponResult"><div class="close">\xd7</div> <div class="results">';a.success?(c.fire("success"),h+=' <div class="label suc"></div>',f=a.title+"</div>",f+="</div>"):(h+='<div class="label fail"></div>',c.fire("fail"),f=a.title+"</div>"),g+="</div>",h+=' <div class="result-text"><div class="result">'+f+'<div class="gray"> </div>'+g+"</div> </div> ",h+="</div>";var i=new b.Popup({prefixCls:"applyCoupon-",zIndex:1e9,mask:!1,content:h,closeable:!0,closeAction:"destroy"});i.render(),i.center(),i.show(),e.on(d.get(".J_close",i.get("el")),"click",function(a){i.destroy()}),e.on(d.get(".close",i.get("el")),"click",function(a){i.destroy()})}}),c},{requires:["overlay"]}),KISSY.add("modules/shop/coupon-mod/index",function(a,b){function c(a){this._mod=a.mod,this._mod&&(this.container=d(this._mod),this.btn=this.container.one(".J_getCoupon"),this.url=this.btn.attr("data-url"),this.userId=window.shop_config.userId||window.shop_config.isvStat.userId,this._init())}var d=a.all;return a.augment(c,{_init:function(){a.log("TshopPsmShopCouponMod init start"),a.log("TshopPsmShopCouponMod init end"),this._bindEvent()},_bindEvent:function(){var a=this;a.btn.on("click",function(){a._getBonus(function(){})})},_getBonus:function(a){var c={url:this.url,safeCode:window.cc&&window.cc.getUA()};new b(c).on("success",function(){a(null)}).on("fail",function(){a(new Error("\u9886\u53d6\u5931\u8d25\uff01"))})}}),c.selector=".tshop-pbsm-shop-coupon-mod",c},{requires:["./coupon/index"]});